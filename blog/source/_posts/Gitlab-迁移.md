---
title: Gitlab 迁移
date: 2018-08-19 16:17:09
tags: Gitlab
---

> Gitlab 是一个优秀的产品，现在已经升级到了 11.6.0 的版本了。

<!--more-->

之前原来组建的`docker`里的`Gitlab`打算迁移出来到一台新机器上了，新机器的硬盘也大。

这次迁移还是费了一阵功夫的。

发现自己的`Gitlab`的版本是`10.1.1`的老版本，最新的版本是`11.1.4`这个版本。

在一开始准备升级的时候提示我升级不成功，需要先升级到`10.8.x`才能升级成功，好吧，先升级到了`10.8`之后然后准备安装`11`的版本。

在一阵等待之后终于安装成功了，因为虚拟机迁移的问题，内部的端口需要重新打开配置，后来发现新机器的 `HTTPS` 正常访问，但是我之前用了 `ssh-key`方式，一直不通很难受。

一开始发现22端口始终是空闲的，其实早该想到 ssh 端口在哪里被用到了，可是愚蠢的我开始去看防火墙，看了下防火墙的配置，发现22端口是打开的，返回来又查，查不到占用。后来看端口转发设置是否有问题，发现端口转发也没问题。奇了怪了，后来问了下大哥，发现 ssh 端口是 16390 端口。。。。。。

于是改了进去 Gitlab 的端口配置，终于生效了。

可是因为虚拟机转发到了一台新主机上，发现端口变了。老机器不认这个 Host 了

GG….

查了一下如何解决之后打开本地的 Know_host 文件把之前对老机器的指纹删掉。_

后续自动发布的时候发现自己之前设置的 hooks 钩子也不生效了。

hhh

别提多烦了，初步确认应该是权限的问题，后来登录了新机器发现果然是权限问题。

同理，删了旧机器的指纹，然后给了权限。

搞定。

